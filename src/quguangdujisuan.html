<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>æ°¸å·çˆ±çœ¼åŸä¸“ä¸šå±ˆå…‰åº¦è®¡ç®—å™¨ - çœ¼ç§‘è§†å…‰å­¦è¾…åŠ©å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind è‡ªå®šä¹‰é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#6366f1',
                        accent: '#f97316',
                        neutral: '#f8fafc',
                        dark: '#1e293b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    screens: {
                        'xs': '360px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tab-active {
                @apply bg-primary text-white;
            }
            .card-shadow {
                @apply shadow-md hover:shadow-lg transition-shadow duration-300;
            }
            .input-style {
                @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all;
            }
            .btn-style {
                @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2;
            }
            .btn-primary {
                @apply btn-style bg-primary text-white hover:bg-primary/90 active:scale-95;
            }
            .btn-secondary {
                @apply btn-style bg-gray-100 text-dark hover:bg-gray-200 active:scale-95;
            }
            .btn-success {
                @apply btn-style bg-success text-white hover:bg-success/90 active:scale-95;
            }
            .btn-warning {
                @apply btn-style bg-warning text-white hover:bg-warning/90 active:scale-90;
            }
            .btn-error {
                @apply btn-style bg-error text-white hover:bg-error/90 active:scale-95;
            }
            .option-btn {
                @apply border-2 rounded-lg p-4 text-center transition-all duration-200;
            }
            .animate-fadeIn {
                @apply animate-opacity transition-opacity duration-500;
            }
            .header-gradient {
                @apply bg-gradient-to-r from-primary/90 to-secondary/90 text-white;
            }
            .sidebar-hidden {
                transform: translateX(-100%);
            }
            .sidebar-visible {
                transform: translateX(0);
            }
            .pulse-animation {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
        }
    </style>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®ï¼Œè§£å†³ä¸åŒæµè§ˆå™¨é»˜è®¤æ ·å¼å·®å¼‚ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* æ»šåŠ¨æ¡ä¼˜åŒ–ï¼Œæå‡ä¸åŒç³»ç»Ÿæ˜¾ç¤ºæ•ˆæœ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* åŠ¨ç”»æ•ˆæœè¡¥å…… */
        .animate-opacity {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* å…è®¸è¾“å…¥æ¡†é€‰æ‹©æ–‡æœ¬ */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* ä¾§è¾¹æ è¿‡æ¸¡æ•ˆæœ */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }
        
        /* ä¸»å†…å®¹åŒºè¿‡æ¸¡æ•ˆæœ */
        #main-content {
            transition: margin-left 0.3s ease-in-out;
        }
        
        /* ä¾§è¾¹æ æ˜¾ç¤º/éšè—æŒ‰é’® */
        #toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 50;
            transition: left 0.3s ease-in-out;
        }
        
        /* è¿”å›ä¸»ç•Œé¢æŒ‰é’®æ ·å¼ */
        .back-to-home {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background-color: #3b82f6;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .back-to-home:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #sidebar {
                width: 100%;
            }
            #main-content {
                margin-left: 0 !important;
            }
            #toggle-sidebar {
                left: 10px;
                top: 10px;
            }
            
            .back-to-home {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 14px;
            }
        }
        
        /* æ‰“å°æ ·å¼ä¼˜åŒ– */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                font-family: "Microsoft YaHei", sans-serif;
                margin: 0;
                padding: 0;
                color: #333;
                font-size: 12px;
            }
            
            .print-container {
                max-width: 800px;
                margin: 0 auto;
                border: 1px solid #ccc;
                border-radius: 8px;
                padding: 20px;
            }
            
            .section {
                padding: 10px 15px;
                margin-bottom: 5px;
            }
            
            /* æ ‡é¢˜æ ·å¼ */
            .title {
                background-color: #f0f7ff;
                text-align: center;
                padding: 15px;
                font-size: 18px;
                font-weight: bold;
                color: #007bff;
                border-bottom: 2px solid #e0ecff;
            }
            .title small {
                font-size: 12px;
                font-weight: normal;
                color: #666;
                display: block;
                margin-top: 5px;
            }

            /* æ‚£è€…ä¿¡æ¯åŒºï¼šä¸€è¡Œä¸‰åˆ— */
            .patient-info {
                background-color: #f8faff;
                display: flex;
                gap: 15px;
                align-items: center;
            }
            .patient-info .item {
                flex: 1;
            }
            .patient-info label {
                font-weight: bold;
                font-size: 14px;
                margin-right: 5px;
            }
            .patient-info .value {
                font-size: 14px;
            }
            .patient-info .note {
                font-size: 12px;
                color: #666;
                display: block;
            }

            /* è®¡ç®—è¯´æ˜åŒº */
            .calc-desc {
                background-color: #f0f8ff;
                font-size: 13px;
                line-height: 1.5;
            }
            .calc-desc strong {
                color: #007bff;
            }

            /* å·¦å³çœ¼å‚æ•°åŒºï¼šå·¦å³åˆ†æ  */
            .eye-params {
                display: flex;
                gap: 5px;
            }
            .eye-col {
                flex: 1;
                padding: 10px 15px;
                border-radius: 4px;
            }
            .right-eye {
                background-color: #e6f3ff;
            }
            .left-eye {
                background-color: #f5e6ff;
            }
            .eye-col h3 {
                margin: 0 0 10px 0;
                font-size: 15px;
                color: #007bff;
            }
            .eye-col .param-item {
                margin-bottom: 10px;
            }
            .eye-col label {
                font-size: 13px;
                display: block;
                margin-bottom: 3px;
            }
            .eye-col .value {
                font-size: 14px;
                font-weight: 500;
            }
            .eye-col .unit {
                font-size: 12px;
                color: #666;
                margin-left: 5px;
            }

            /* è®¡ç®—ç»“æœåŒº */
            .calc-result {
                background-color: #f0fff0;
                padding: 15px;
            }
            .result-row {
                display: flex;
                gap: 15px;
                margin-bottom: 15px;
            }
            .result-col {
                flex: 1;
                text-align: center;
                background-color: #fff;
                padding: 10px;
                border-radius: 4px;
            }
            .result-col .label {
                font-size: 13px;
                color: #666;
            }
            .result-col .value {
                font-size: 20px;
                font-weight: bold;
                color: #007bff;
                margin: 5px 0;
            }
            .result-col .desc {
                font-size: 12px;
                color: #666;
            }
            .detail-analysis {
                font-size: 13px;
                line-height: 1.6;
            }
            .detail-analysis div {
                margin-bottom: 5px;
            }
            
            /* åˆå¹¶æ‚£è€…ä¿¡æ¯å’Œç»“æœåŒºåŸŸ */
            .info-result-container {
                display: flex;
                flex-direction: column;
                border: 1px solid #ccc;
                border-radius: 8px;
                overflow: hidden;
            }
            
            .info-section {
                background-color: #f8faff;
                padding: 15px;
                border-bottom: 1px solid #ccc;
            }
            
            .result-section {
                padding: 15px;
            }
        }
        
        /* æ‰“å°æ¨¡æ¿æ ·å¼ */
        .print-template {
            display: none;
        }
        
        @media screen {
            .print-template {
                position: absolute;
                left: -9999px;
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-blue-50 to-indigo-100 text-dark min-h-screen">
    <!-- è¿”å›ä¸»ç•Œé¢æŒ‰é’® -->
    <a href="index.html" class="back-to-home" target="_self">ğŸ  è¿”å›ä¸»é¡µ</a>

    <!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
    <button id="toggle-sidebar" class="bg-primary text-white p-3 rounded-full shadow-lg hover:bg-primary/90 transition-all duration-200 no-print" style="position: fixed; top: 20px; left: 20px; z-index: 50;">
        <i class="fa fa-bars"></i>
    </button>

    <div class="flex">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <div id="sidebar" class="sidebar-visible w-64 min-h-screen bg-white shadow-lg fixed md:relative z-40 no-print">
            <!-- å¤´éƒ¨æ ‡é¢˜ -->
            <header class="text-center p-6 md:p-8 header-gradient">
                <h1 class="text-xl font-bold mb-3 flex items-center justify-center">
                    <i class="fa fa-calculator mr-3"></i> æ°¸å·çˆ±çœ¼åŸ
                </h1>
                <p class="text-sm opacity-90">çœ¼ç§‘è§†å…‰å­¦è¾…åŠ©å·¥å…·</p>
            </header>

            <!-- åŠŸèƒ½å¯¼èˆª -->
            <nav class="p-4 space-y-2">
                <div class="bg-blue-50 rounded-lg p-3 mb-4">
                    <div class="text-xs text-blue-600 font-medium mb-1">å¿«é€Ÿæ“ä½œ</div>
                    <button onclick="fillExampleData()" class="w-full text-left py-2 px-3 rounded-md text-sm transition-all flex items-center text-blue-700 hover:bg-blue-100">
                        <i class="fa fa-magic mr-2 w-4 text-center"></i>å®ä¾‹å¡«å……
                    </button>
                    <button onclick="clearAllData()" class="w-full text-left py-2 px-3 rounded-md text-sm transition-all flex items-center text-red-600 hover:bg-red-50">
                        <i class="fa fa-trash mr-2 w-4 text-center"></i>æ¸…ç©ºæ•°æ®
                    </button>
                </div>
                
                <div class="border-t pt-4">
                    <button class="w-full text-left py-3 px-4 rounded-lg transition-all flex items-center text-gray-600 hover:bg-gray-100 no-print">
                        <i class="fa fa-info-circle mr-3 w-5 text-center"></i>ä½¿ç”¨è¯´æ˜
                    </button>
                </div>
            </nav>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div id="main-content" class="flex-1 min-h-screen md:ml-64 transition-all duration-300">
            <div class="container mx-auto px-4 py-6 md:py-8 max-w-7xl">
                <!-- åŠŸèƒ½é¢æ¿å®¹å™¨ -->
                <div class="bg-white rounded-lg md:rounded-xl p-4 md:p-6 card-shadow">
                    <!-- æ ‡é¢˜åŒºåŸŸ -->
                    <div class="text-center mb-8">
                        <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2 flex items-center justify-center">
                            <i class="fa fa-calculator mr-3"></i>æ°¸å·çˆ±çœ¼åŸè§†å…‰è¾…åŠ©å·¥å…·
                        </h1>
                        <p class="text-gray-600">åŸºäºçœ¼è½´é•¿åº¦ã€è§’è†œæ›²ç‡ç­‰å‚æ•°çš„ç²¾ç¡®å±ˆå…‰åº¦è®¡ç®—</p>
                    </div>

                    <!-- æ‚£è€…ä¿¡æ¯ -->
                    <div class="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-lg p-5 border border-cyan-200 mb-6">
                        <h3 class="text-xl font-semibold mb-4 text-dark flex items-center">
                            <i class="fa fa-user text-primary mr-2"></i>æ‚£è€…ä¿¡æ¯
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">å§“å</label>
                                <input type="text" id="patientName" class="input-style" placeholder="è¯·è¾“å…¥æ‚£è€…å§“å">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">å¹´é¾„</label>
                                <input type="number" id="commonAge" step="1" min="6" max="18" class="input-style" placeholder="è¾“å…¥å‘¨å²å¹´é¾„">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">è”ç³»ç”µè¯</label>
                                <input type="tel" id="patientPhone" class="input-style" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                            </div>
                        </div>
                    </div>

                    <!-- è¯´æ˜å¡ç‰‡ -->
                    <div class="bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200">
                        <h3 class="text-lg font-semibold mb-2 text-blue-800 flex items-center">
                            <i class="fa fa-lightbulb-o mr-2 text-blue-600"></i>è®¡ç®—è¯´æ˜
                        </h3>
                        <p class="text-sm text-gray-700">
                            æœ¬è®¡ç®—å™¨ä½¿ç”¨å…ˆè¿›çš„å±ˆå…‰åº¦é¢„æµ‹ç®—æ³•ï¼Œç»“åˆå¹´é¾„ã€è§’è†œæ›²ç‡ã€çœ¼è½´é•¿åº¦ã€å‰æˆ¿æ·±åº¦ã€æ™¶ä½“åšåº¦ç­‰å‚æ•°ï¼Œ
                            ç²¾ç¡®è®¡ç®—å‡ºæ‚¨çš„å±ˆå…‰åº¦ã€‚é€‚ç”¨äºå„¿ç«¥è¿‘è§†é˜²æ§ã€æˆäººéªŒå…‰é…é•œç­‰åœºæ™¯ã€‚
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- å³çœ¼å‚æ•° -->
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-5 border border-blue-200">
                            <h3 class="text-xl font-semibold mb-4 text-dark flex items-center">
                                <i class="fa fa-eye text-primary mr-2"></i>å³çœ¼å‚æ•°
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è§’è†œæ›²ç‡ (K1)</label>
                                    <input type="number" id="R_K1" step="0.01" class="input-style" placeholder="è¾“å…¥è§’è†œæ›²ç‡">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šDï¼Œæ­£å¸¸èŒƒå›´çº¦40-45D</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">çœ¼è½´é•¿åº¦ (AL)</label>
                                    <input type="number" id="R_AL" step="0.01" class="input-style" placeholder="è¾“å…¥çœ¼è½´é•¿åº¦">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´çº¦22-25mm</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å‰æˆ¿æ·±åº¦ (AD)</label>
                                    <input type="number" id="R_AD" step="0.1" min="2.6" max="3.9" class="input-style" placeholder="2.6-3.9">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´2.6-3.9mm</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ™¶ä½“åšåº¦ (LT)</label>
                                    <input type="number" id="R_LT" step="0.1" min="3.1" max="5.0" class="input-style" placeholder="3.1-5.0">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´3.1-5.0mm</div>
                                </div>
                            </div>
                        </div>

                        <!-- å·¦çœ¼å‚æ•° -->
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-5 border border-purple-200">
                            <h3 class="text-xl font-semibold mb-4 text-dark flex items-center">
                                <i class="fa fa-eye text-secondary mr-2"></i>å·¦çœ¼å‚æ•°
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è§’è†œæ›²ç‡ (K1)</label>
                                    <input type="number" id="L_K1" step="0.01" class="input-style" placeholder="è¾“å…¥è§’è†œæ›²ç‡">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šDï¼Œæ­£å¸¸èŒƒå›´çº¦40-45D</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">çœ¼è½´é•¿åº¦ (AL)</label>
                                    <input type="number" id="L_AL" step="0.01" class="input-style" placeholder="è¾“å…¥çœ¼è½´é•¿åº¦">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´çº¦22-25mm</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å‰æˆ¿æ·±åº¦ (AD)</label>
                                    <input type="number" id="L_AD" step="0.1" min="2.6" max="3.9" class="input-style" placeholder="2.6-3.9">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´2.6-3.9mm</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ™¶ä½“åšåº¦ (LT)</label>
                                    <input type="number" id="L_LT" step="0.1" min="3.1" max="5.0" class="input-style" placeholder="3.1-5.0">
                                    <div class="text-xs text-gray-500 mt-1">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´3.1-5.0mm</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è®¡ç®—æŒ‰é’® -->
                    <div class="mt-8 text-center">
                        <button onclick="calculateRefraction()" class="btn-primary px-8 py-3 text-lg">
                            <i class="fa fa-cogs mr-2"></i>å¼€å§‹ç²¾ç¡®è®¡ç®—
                        </button>
                        <p class="text-sm text-gray-500 mt-2">ç‚¹å‡»æŒ‰é’®è·å–ä¸“ä¸šçš„å±ˆå…‰åº¦åˆ†æç»“æœ</p>
                    </div>

                    <!-- è®¡ç®—ç»“æœ -->
                    <div id="refractionResult" class="mt-8 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-5 border border-green-200 hidden">
                        <h3 class="text-xl font-semibold mb-4 text-green-700 flex items-center">
                            <i class="fa fa-bar-chart mr-2"></i>è®¡ç®—ç»“æœ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg p-4 shadow-sm border border-green-100 text-center">
                                <div class="text-sm text-gray-600 mb-1">å³çœ¼å±ˆå…‰åº¦</div>
                                <div id="R_result" class="text-3xl font-bold text-primary">--</div>
                                <div class="text-xs text-gray-500 mt-1">çƒé•œåº¦æ•°</div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm border border-green-100 text-center">
                                <div class="text-sm text-gray-600 mb-1">å·¦çœ¼å±ˆå…‰åº¦</div>
                                <div id="L_result" class="text-3xl font-bold text-secondary">--</div>
                                <div class="text-xs text-gray-500 mt-1">çƒé•œåº¦æ•°</div>
                            </div>
                        </div>
                        
                        <!-- è¯¦ç»†åˆ†æ -->
                        <div class="mt-6 bg-white rounded-lg p-4 border border-gray-200">
                            <h4 class="font-semibold text-gray-800 mb-3">è¯¦ç»†åˆ†æ</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="flex justify-between py-1">
                                    <span class="text-gray-600">å³çœ¼å‚æ•°:</span>
                                    <span id="R_params" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span class="text-gray-600">å·¦çœ¼å‚æ•°:</span>
                                    <span id="L_params" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span class="text-gray-600">å±ˆå…‰å·®å¼‚:</span>
                                    <span id="refraction_diff" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span class="text-gray-600">å»ºè®®:</span>
                                    <span id="recommendation" class="font-medium">-</span>
                                </div>
                            </div>
                        </div>
                        
                    
                    <!-- æç¤ºä¿¡æ¯ -->
                    <div class="mt-8 bg-yellow-50 rounded-lg p-4 border border-yellow-200 no-print">
                        <h4 class="font-semibold text-yellow-800 mb-2 flex items-center">
                            <i class="fa fa-exclamation-triangle mr-2"></i>é‡è¦æé†’
                        </h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>â€¢ æœ¬è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šçœ¼ç§‘è§†å…‰å­¦ä¸“å®¶çš„è¯Šæ–­</li>
                            <li>â€¢ å¦‚éœ€é…é•œæˆ–æ²»ç–—ï¼Œè¯·å’¨è¯¢ä¸“ä¸šçœ¼ç§‘è§†å…‰å­¦ä¸“å®¶</li>
                            <li>â€¢ è®¡ç®—ç²¾åº¦å—æµ‹é‡å‡†ç¡®æ€§å½±å“ï¼Œè¯·ç¡®ä¿æ•°æ®å‡†ç¡®</li>
                            <li>â€¢ å»ºè®®å®šæœŸè¿›è¡Œä¸“ä¸šçœ¼ç§‘æ£€æŸ¥</li>
                        </ul>
                    </div>
                </div>

                <!-- é¡µè„š -->
                <footer class="mt-8 text-center text-gray-500 text-sm py-4 no-print">
                    <p>Â© 2026 ä¸“ä¸šçœ¼ç§‘è§†å…‰å­¦è¾…åŠ©å¹³å° | æ•°æ®éšç§ä¿æŠ¤ | æŠ€æœ¯æ”¯æŒï¼šå›è¯´è§†å…‰</p>
                </footer>
            </div>
        </div>
    </div>

    <!-- æ‰“å°æ¨¡æ¿ -->
    <div id="printTemplate" class="print-template">
        <div class="print-container info-result-container">
            <!-- æ ‡é¢˜åŒº -->
            <div class="section title">
                ä¸“ä¸šå±ˆå…‰åº¦è®¡ç®—å™¨
                <small>åŸºäºçœ¼è½´é•¿åº¦ã€è§’è†œæ›²ç‡ç­‰å‚æ•°çš„ç²¾ç¡®å±ˆå…‰åº¦è®¡ç®—</small>
            </div>

            <!-- æ‚£è€…ä¿¡æ¯åŒºå’Œç»“æœåŒºåˆå¹¶ -->
            <div class="info-section">
                <h4 style="margin:0 0 10px; font-size:16px; color:#007bff;">æ‚£è€…ä¿¡æ¯</h4>
                <div class="patient-info">
                    <div class="item">
                        <label>å§“åï¼š</label>
                        <span id="printName" class="value">é—«å¡”é›…</span>
                    </div>
                    <div class="item">
                        <label>å¹´é¾„ï¼š</label>
                        <span id="printAge" class="value">11</span>
                        <span class="note">å·¦å³çœ¼å…±åŒæˆå¹´å¹´é¾„</span>
                    </div>
                    <div class="item">
                        <label>è”ç³»ç”µè¯ï¼š</label>
                        <span id="printPhone" class="value">13574610303</span>
                    </div>
                </div>
                
                <div class="result-row" style="margin-top: 15px;">
                    <div class="result-col">
                        <div class="label">å³çœ¼å±ˆå…‰åº¦</div>
                        <div class="value"><span id="printRResult">0.55 D</span></div>
                        <div class="desc">çƒé•œåº¦æ•°</div>
                    </div>
                    <div class="result-col">
                        <div class="label">å·¦çœ¼å±ˆå…‰åº¦</div>
                        <div class="value"><span id="printLResult">-0.65 D</span></div>
                        <div class="desc">çƒé•œåº¦æ•°</div>
                    </div>
                </div>
            </div>

            <!-- è®¡ç®—è¯´æ˜åŒº -->
            <div class="section calc-desc">
                <strong>è®¡ç®—è¯´æ˜ï¼š</strong>
                æœ¬è®¡ç®—ç¨‹åºä½¿ç”¨å…ˆè¿›çš„å±ˆå…‰é¢„æµ‹ç®—æ³•ï¼Œç»“åˆå¹´é¾„ã€è§’è†œæ›²ç‡ã€çœ¼è½´é•¿åº¦ã€å‰æˆ¿æ·±åº¦ã€æ™¶ä½“åšåº¦ç­‰å‚æ•°ï¼Œç²¾ç¡®è®¡ç®—å‡ºæ‚¨çš„å±ˆå…‰åº¦ï¼Œé€‚ç”¨äºå„¿ç«¥è¿‘è§†é˜²æ§ã€æˆäººéªŒå…‰é…é•œç­‰åœºæ™¯ã€‚
            </div>

            <!-- å·¦å³çœ¼å‚æ•°åŒº -->
            <div class="eye-params">
                <!-- å³çœ¼å‚æ•° -->
                <div class="eye-col right-eye section">
                    <h3>å³çœ¼å‚æ•°</h3>
                    <div class="param-item">
                        <label>è§’è†œæ›²ç‡(K1)</label>
                        <span id="printRK1" class="value">43.50</span>
                        <span class="unit">å•ä½ï¼šDï¼Œæ­£å¸¸èŒƒå›´40-45D</span>
                    </div>
                    <div class="param-item">
                        <label>çœ¼è½´é•¿åº¦(AL)</label>
                        <span id="printRAL" class="value">23.32</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´22-25mm</span>
                    </div>
                    <div class="param-item">
                        <label>å‰æˆ¿æ·±åº¦(AD)</label>
                        <span id="printRAD" class="value">3.2</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´2.6-3.8mm</span>
                    </div>
                    <div class="param-item">
                        <label>æ™¶ä½“åšåº¦(LT)</label>
                        <span id="printRLT" class="value">3.6</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´3.1-5.0mm</span>
                    </div>
                </div>

                <!-- å·¦çœ¼å‚æ•° -->
                <div class="eye-col left-eye section">
                    <h3>å·¦çœ¼å‚æ•°</h3>
                    <div class="param-item">
                        <label>è§’è†œæ›²ç‡(K1)</label>
                        <span id="printLK1" class="value">43.75</span>
                        <span class="unit">å•ä½ï¼šDï¼Œæ­£å¸¸èŒƒå›´40-45D</span>
                    </div>
                    <div class="param-item">
                        <label>çœ¼è½´é•¿åº¦(AL)</label>
                        <span id="printLAL" class="value">23.50</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´22-25mm</span>
                    </div>
                    <div class="param-item">
                        <label>å‰æˆ¿æ·±åº¦(AD)</label>
                        <span id="printLAD" class="value">3.1</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´2.6-3.8mm</span>
                    </div>
                    <div class="param-item">
                        <label>æ™¶ä½“åšåº¦(LT)</label>
                        <span id="printLLT" class="value">3.8</span>
                        <span class="unit">å•ä½ï¼šmmï¼Œæ­£å¸¸èŒƒå›´3.1-5.0mm</span>
                    </div>
                </div>
            </div>

            <!-- è¯¦ç»†åˆ†æåŒº -->
            <div class="section calc-result">
                <div class="detail-analysis">
                    <div><strong>è¯¦ç»†åˆ†æ</strong></div>
                    <div id="printRParams">å³çœ¼å‚æ•°ï¼š å¹´é¾„:12, K1:43.5, AL:23.32</div>
                    <div id="printLParams">å·¦çœ¼å‚æ•°ï¼š å¹´é¾„:12, K1:43.75, AL:23.5</div>
                    <div>å±ˆå…‰å·®å¼‚ï¼š<span id="printDiff">1.20</span> D &nbsp;&nbsp; å»ºè®®: <span id="printRecommendation">è½»åº¦è¿‘è§†</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¦ç”¨å³é”®èœå•
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // ç¦ç”¨F12å’ŒCtrl+Shift+Iå’ŒCtrl+Uç­‰å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // ç¦ç”¨F12
            if(e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            // ç¦ç”¨Ctrl+U (æŸ¥çœ‹é¡µé¢æºä»£ç )
            if(e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            // ç¦ç”¨Ctrl+Shift+I (å¼€å‘è€…å·¥å…·)
            if(e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            // ç¦ç”¨Ctrl+Shift+J (å¼€å‘è€…å·¥å…·)
            if(e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            // ç¦ç”¨Ctrl+Shift+C (å¼€å‘è€…å·¥å…·)
            if(e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }
        });

        // ==================== ä¾§è¾¹æ æ§åˆ¶ ====================
        let sidebarVisible = true;
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const toggleButton = document.getElementById('toggle-sidebar');
            
            if (sidebarVisible) {
                sidebar.classList.remove('sidebar-visible');
                sidebar.classList.add('sidebar-hidden');
                mainContent.style.marginLeft = '0';
                toggleButton.style.left = '20px';
                toggleButton.innerHTML = '<i class="fa fa-bars"></i>';
            } else {
                sidebar.classList.remove('sidebar-hidden');
                sidebar.classList.add('sidebar-visible');
                mainContent.style.marginLeft = '16rem';
                toggleButton.style.left = '280px';
                toggleButton.innerHTML = '<i class="fa fa-chevron-left"></i>';
            }
            
            sidebarVisible = !sidebarVisible;
        }
        
        document.getElementById('toggle-sidebar').addEventListener('click', toggleSidebar);
        
        // åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé»˜è®¤éšè—ä¾§è¾¹æ 
        if (window.innerWidth < 768) {
            sidebarVisible = false;
            toggleSidebar();
        }

        // ==================== å®Œæ•´ä¿®æ­£è§„åˆ™è¡¨ ====================
        const modificationRules = {
            2.6: [
                {minLT:3.1, maxLT:3.1, value:-1.125},
                {minLT:3.2, maxLT:3.5, value:-1.25},
                {minLT:3.6, maxLT:3.6, value:-1.375},
                {minLT:3.7, maxLT:4.0, value:-1.50},
                {minLT:4.1, maxLT:4.1, value:-1.625},
                {minLT:4.2, maxLT:4.5, value:-1.75},
                {minLT:4.6, maxLT:4.6, value:-1.875},
                {minLT:4.7, maxLT:5.0, value:-2.00}
            ],
            2.7: [
                {minLT:3.1, maxLT:3.1, value:-0.75},
                {minLT:3.2, maxLT:3.2, value:-0.875},
                {minLT:3.3, maxLT:3.6, value:-1.00},
                {minLT:3.7, maxLT:3.7, value:-1.125},
                {minLT:3.8, maxLT:4.1, value:-1.25},
                {minLT:4.2, maxLT:4.2, value:-1.375},
                {minLT:4.3, maxLT:4.6, value:-1.50},
                {minLT:4.7, maxLT:4.7, value:-1.625},
                {minLT:4.8, maxLT:5.0, value:-1.75}
            ],
            2.8: [
                {minLT:3.1, maxLT:3.2, value:-0.50},
                {minLT:3.3, maxLT:3.3, value:-0.625},
                {minLT:3.4, maxLT:3.7, value:-0.75},
                {minLT:3.8, maxLT:3.8, value:-0.875},
                {minLT:3.9, maxLT:4.2, value:-1.00},
                {minLT:4.3, maxLT:4.3, value:-1.125},
                {minLT:4.4, maxLT:4.7, value:-1.25},
                {minLT:4.8, maxLT:4.8, value:-1.375},
                {minLT:4.9, maxLT:5.0, value:-1.50}
            ],
            2.9: [
                {minLT:3.1, maxLT:3.3, value:-0.25},
                {minLT:3.4, maxLT:3.4, value:-0.375},
                {minLT:3.5, maxLT:3.8, value:-0.50},
                {minLT:3.9, maxLT:3.9, value:-0.625},
                {minLT:4.0, maxLT:4.3, value:-0.75},
                {minLT:4.4, maxLT:4.4, value:-0.875},
                {minLT:4.5, maxLT:4.8, value:-1.00},
                {minLT:4.9, maxLT:4.9, value:-1.125},
                {minLT:5.0, maxLT:5.0, value:-1.50}
            ],
            3.0: [
                {minLT:3.1, maxLT:3.4, value:0.00},
                {minLT:3.5, maxLT:3.5, value:-0.125},
                {minLT:3.6, maxLT:3.9, value:-0.25},
                {minLT:4.0, maxLT:4.0, value:-0.375},
                {minLT:4.1, maxLT:4.4, value:-0.50},
                {minLT:4.5, maxLT:4.5, value:-0.625},
                {minLT:4.6, maxLT:4.9, value:-0.75},
                {minLT:5.0, maxLT:5.0, value:-0.875}
            ],
            3.1: [
                {minLT:3.1, maxLT:3.5, value:0.25},
                {minLT:3.6, maxLT:4.0, value:0.00},
                {minLT:4.1, maxLT:4.5, value:-0.25},
                {minLT:4.6, maxLT:5.0, value:-0.50}
            ],
            3.2: [
                {minLT:3.1, maxLT:3.2, value:0.75},
                {minLT:3.2, maxLT:3.2, value:0.625},
                {minLT:3.3, maxLT:3.6, value:0.50},
                {minLT:3.7, maxLT:3.7, value:0.375},
                {minLT:3.8, maxLT:4.1, value:0.25},
                {minLT:4.2, maxLT:4.2, value:0.125},
                {minLT:4.3, maxLT:4.6, value:0.00},
                {minLT:4.7, maxLT:4.7, value:-0.125},
                {minLT:4.8, maxLT:5.0, value:-0.25}
            ],
            3.3: [
                {minLT:3.1, maxLT:3.2, value:+1.00},
                {minLT:3.3, maxLT:3.3, value:+0.875},
                {minLT:3.4, maxLT:3.7, value:+0.75},
                {minLT:3.8, maxLT:3.8, value:+0.625},
                {minLT:3.9, maxLT:4.2, value:+0.50},
                {minLT:4.3, maxLT:4.3, value:+0.375},
                {minLT:4.4, maxLT:4.7, value:+0.25},
                {minLT:4.8, maxLT:4.8, value:+0.125},
                {minLT:4.9, maxLT:5.0, value:+0.00}
            ],
            3.4: [
                {minLT:3.1, maxLT:3.3, value:+1.25},
                {minLT:3.4, maxLT:3.4, value:+1.125},
                {minLT:3.5, maxLT:3.8, value:+1.00},
                {minLT:3.9, maxLT:3.9, value:+0.875},
                {minLT:4.0, maxLT:4.3, value:+0.75},
                {minLT:4.4, maxLT:4.4, value:+0.625},
                {minLT:4.5, maxLT:4.7, value:+0.25},
                {minLT:4.8, maxLT:4.8, value:+0.125},
                {minLT:4.9, maxLT:5.0, value:-0.25}
            ],
            3.5: [
                {minLT:3.1, maxLT:3.4, value:+1.50},
                {minLT:3.5, maxLT:3.5, value:+1.375},
                {minLT:3.6, maxLT:3.9, value:+1.25},
                {minLT:4.0, maxLT:4.0, value:+1.125},
                {minLT:4.1, maxLT:4.4, value:+1.00},
                {minLT:4.5, maxLT:4.5, value:+0.875},
                {minLT:4.6, maxLT:4.9, value:+0.75},
                {minLT:5.0, maxLT:5.0, value:+0.625}
            ],
            3.6: [
                {minLT:3.1, maxLT:3.1, value:+1.875},
                {minLT:3.2, maxLT:3.5, value:+1.75},
                {minLT:3.6, maxLT:3.6, value:+1.625},
                {minLT:3.7, maxLT:4.0, value:+1.50},
                {minLT:4.1, maxLT:4.1, value:+1.375},
                {minLT:4.2, maxLT:4.5, value:+1.25},
                {minLT:4.6, maxLT:4.6, value:+1.125},
                {minLT:4.7, maxLT:5.0, value:+1.00}
            ],
            3.7: [
                {minLT:3.1, maxLT:3.1, value:+2.25},
                {minLT:3.2, maxLT:3.2, value:+2.125},
                {minLT:3.3, maxLT:3.6, value:+2.00},
                {minLT:3.7, maxLT:3.7, value:+1.875},
                {minLT:3.8, maxLT:4.1, value:+1.75},
                {minLT:4.2, maxLT:4.2, value:+1.625},
                {minLT:4.3, maxLT:4.6, value:+1.50},
                {minLT:4.7, maxLT:4.7, value:+1.125},
                {minLT:4.8, maxLT:5.0, value:+1.00}
            ],
            3.8: [
                {minLT:3.1, maxLT:3.2, value:+2.50},
                {minLT:3.3, maxLT:3.3, value:+2.375},
                {minLT:3.4, maxLT:3.7, value:+2.25},
                {minLT:3.8, maxLT:3.8, value:+2.125},
                {minLT:3.9, maxLT:4.2, value:+2.00},
                {minLT:4.3, maxLT:4.3, value:+1.875},
                {minLT:4.4, maxLT:4.7, value:+1.75},
                {minLT:4.8, maxLT:4.8, value:+1.625},
                {minLT:4.9, maxLT:5.0, value:+1.50}
            ],
            3.9: [
                {minLT:3.1, maxLT:3.3, value:+2.75},
                {minLT:3.4, maxLT:3.4, value:+2.625},
                {minLT:3.5, maxLT:3.8, value:+2.50},
                {minLT:3.9, maxLT:3.9, value:+2.375},
                {minLT:4.0, maxLT:4.3, value:+2.25},
                {minLT:4.4, maxLT:4.4, value:+2.125},
                {minLT:4.5, maxLT:4.8, value:+2.00},
                {minLT:4.9, maxLT:4.9, value:+1.875},
                {minLT:5.0, maxLT:5.0, value:+1.75}
            ]
        };

        // å¹´é¾„å¯¹åº”æ•°æ®
        const ageData = {
            6: {hyperopia: 1.38, al: 22.46},
            7: {hyperopia: 1.38, al: 22.56},
            8: {hyperopia: 1.25, al: 22.78},
            9: {hyperopia: 0.88, al: 22.95},
            10: {hyperopia: 0.75, al: 23.13},
            11: {hyperopia: 0.63, al: 23.26},
            12: {hyperopia: 0.50, al: 23.32},
            13: {hyperopia: 0.50, al: 23.36},
            14: {hyperopia: 0.38, al: 23.37},
            15: {hyperopia: 0.31, al: 23.39},
            16: {hyperopia: 0.25,  al: 23.41 },
            17: {hyperopia: 0.12,  al: 23.46 },
            18: {hyperopia: 0.00,  al: 23.5 }
        };

        // è¾“å…¥éªŒè¯å‡½æ•°
        function validateInput(value, min, max, name) {
            if (value === null || value === undefined || value === '') {
                throw new Error(`${name}ä¸èƒ½ä¸ºç©º`);
            }
            if (isNaN(value)) {
                throw new Error(`${name}å¿…é¡»æ˜¯æ•°å­—`);
            }
            if (value < min || value > max) {
                throw new Error(`${name}å¿…é¡»åœ¨ ${min}-${max} èŒƒå›´å†…`);
            }
            return true;
        }

        // æŸ¥æ‰¾ä¿®æ­£å€¼
        function getModification(AD, LT) {
            AD = parseFloat(AD.toFixed(1));
            LT = parseFloat(LT.toFixed(1));
            
            const rules = modificationRules[AD];
            if (!rules) return 0;
            for (const rule of rules) {
                if (LT >= rule.minLT && LT <= rule.maxLT) {
                    return rule.value;
                }
            }
            return 0;
        }

        // è®¡ç®—å•ä¸ªçœ¼ç›
        function calculateEye(age, K1, AL, AD, LT) {
            // éªŒè¯è¾“å…¥å‚æ•°
            validateInput(age, 6, 18, 'å¹´é¾„');
            validateInput(K1, 30, 50, 'è§’è†œæ›²ç‡');
            validateInput(AL, 18, 30, 'çœ¼è½´é•¿åº¦');
            validateInput(AD, 2.0, 5.0, 'å‰æˆ¿æ·±åº¦');
            validateInput(LT, 3.0, 6.0, 'æ™¶ä½“åšåº¦');
            
            // ç¡®ä¿å¹´é¾„åœ¨æœ‰æ•ˆèŒƒå›´å†…
            age = age < 6 ? 6 : age > 18 ? 18 : age;
            
            // è·å–å¹´é¾„å¯¹åº”çš„æ•°æ®
            const ageInfo = ageData[Math.floor(age)] || ageData[18];
            
            // è®¡ç®—ä¿®æ­£å€¼
            const modification = getModification(AD, LT);
            
            // è®¡ç®—å±ˆå…‰åº¦
            const term1 = ageInfo.hyperopia;
            const term2 = 43.05 - K1;
            const term3 = (ageInfo.al - AL) * 2.5;
            
            return (modification + term1 + term2 + term3).toFixed(2);
        }

        // ä¸»è®¡ç®—å‡½æ•°
        function calculateRefraction() {
            try {
                // è·å–å…¬å…±å¹´é¾„
                const commonAge = parseInt(document.getElementById('commonAge').value);
                if (isNaN(commonAge)) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„');
                    return;
                }
                
                // è·å–å³çœ¼å‚æ•°
                const R_K1 = parseFloat(document.getElementById('R_K1').value);
                const R_AL = parseFloat(document.getElementById('R_AL').value);
                const R_AD = parseFloat(document.getElementById('R_AD').value);
                const R_LT = parseFloat(document.getElementById('R_LT').value);
                
                // è·å–å·¦çœ¼å‚æ•°
                const L_K1 = parseFloat(document.getElementById('L_K1').value);
                const L_AL = parseFloat(document.getElementById('L_AL').value);
                const L_AD = parseFloat(document.getElementById('L_AD').value);
                const L_LT = parseFloat(document.getElementById('L_LT').value);

                // éªŒè¯è¾“å…¥
                if (!R_K1 || !R_AL || !R_AD || !R_LT) {
                    alert('è¯·å®Œå–„å³çœ¼æ‰€æœ‰å‚æ•°');
                    return;
                }
                if (!L_K1 || !L_AL || !L_AD || !L_LT) {
                    alert('è¯·å®Œå–„å·¦çœ¼æ‰€æœ‰å‚æ•°');
                    return;
                }

                // è®¡ç®—å¹¶æ˜¾ç¤ºç»“æœ
                const R_result = calculateEye(commonAge, R_K1, R_AL, R_AD, R_LT);
                const L_result = calculateEye(commonAge, L_K1, L_AL, L_AD, L_LT);
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('R_result').textContent = `${R_result} D`;
                document.getElementById('L_result').textContent = `${L_result} D`;
                
                // æ˜¾ç¤ºè¯¦ç»†åˆ†æ
                document.getElementById('R_params').textContent = `å¹´é¾„:${commonAge}, K1:${R_K1}, AL:${R_AL}`;
                document.getElementById('L_params').textContent = `å¹´é¾„:${commonAge}, K1:${L_K1}, AL:${L_AL}`;
                
                const diff = Math.abs(parseFloat(R_result) - parseFloat(L_result)).toFixed(2);
                document.getElementById('refraction_diff').textContent = `${diff} D`;
                
                // ç”Ÿæˆå»ºè®®
                let recommendation = '';
                if (Math.abs(parseFloat(R_result)) > 6 || Math.abs(parseFloat(L_result)) > 6) {
                    recommendation = 'é«˜åº¦è¿‘è§†/è¿œè§†';
                } else if (diff > 2.5) {
                    recommendation = 'å±ˆå…‰å‚å·®éœ€å…³æ³¨';
                } else if (parseFloat(R_result) > 0 || parseFloat(L_result) > 0) {
                    recommendation = 'è½»åº¦è¿œè§†';
                } else {
                    recommendation = 'æ­£å¸¸èŒƒå›´';
                }
                document.getElementById('recommendation').textContent = recommendation;

                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                document.getElementById('refractionResult').classList.remove('hidden');
                
                // ç»“æœåŠ¨ç”»æ•ˆæœ
                const resultDiv = document.getElementById('refractionResult');
                resultDiv.classList.add('pulse-animation');
                setTimeout(() => {
                    resultDiv.classList.remove('pulse-animation');
                }, 2000);
            } catch (error) {
                alert(`è®¡ç®—é”™è¯¯: ${error.message}`);
            }
        }

        // å¡«å……å®ä¾‹æ•°æ®
        function fillExampleData() {
            document.getElementById('patientName').value = 'é—«å¡”é›…';
            document.getElementById('commonAge').value = 11;
            document.getElementById('patientPhone').value = '13574610303';
            
            document.getElementById('R_K1').value = 42.47;
            document.getElementById('R_AL').value = 24.48;
            document.getElementById('R_AD').value = 3.7;
            document.getElementById('R_LT').value = 3.63;
            
            document.getElementById('L_K1').value = 41.99;
            document.getElementById('L_AL').value = 24.73;
            document.getElementById('L_AD').value = 3.7;
            document.getElementById('L_LT').value = 3.61;
            
            // è‡ªåŠ¨è®¡ç®—
            setTimeout(calculateRefraction, 100);
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                document.getElementById('patientName').value = '';
                document.getElementById('commonAge').value = '';
                document.getElementById('patientPhone').value = '';
                
                document.getElementById('R_K1').value = '';
                document.getElementById('R_AL').value = '';
                document.getElementById('R_AD').value = '';
                document.getElementById('R_LT').value = '';
                
                document.getElementById('L_K1').value = '';
                document.getElementById('L_AL').value = '';
                document.getElementById('L_AD').value = '';
                document.getElementById('L_LT').value = '';
                
                // éšè—ç»“æœ
                document.getElementById('refractionResult').classList.add('hidden');
            }
        }

        // å¡«å……æ‰“å°æ¨¡æ¿
        function fillPrintTemplate() {
            // å•è¡Œä¼˜åŒ–ï¼šæ‚£è€…åŸºç¡€ä¿¡æ¯èµ‹å€¼
            [['printName','patientName','æœªçŸ¥'],['printAge','commonAge','18'],['printPhone','patientPhone','æœªçŸ¥']].forEach(([p,i,d])=>document.getElementById(p).textContent=document.getElementById(i).value||d);
            
            // å·¦å³çœ¼å‚æ•° - åˆ†ç»„å¼ä¸¤åˆ—ä¼˜åŒ–ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰
            const eyeParams = {
                right: [['printRK1','R_K1','0.00'],['printRAL','R_AL','0.00'],['printRAD','R_AD','0.0'],['printRLT','R_LT','0.0']], // å³çœ¼åˆ—
                left: [['printLK1','L_K1','0.00'],['printLAL','L_AL','0.00'],['printLAD','L_AD','0.0'],['printLLT','L_LT','0.0']]   // å·¦çœ¼åˆ—
            };
            // éå†èµ‹å€¼ï¼ˆå…ˆå³çœ¼ã€åå·¦çœ¼ï¼‰
            [...eyeParams.right, ...eyeParams.left].forEach(([p,i,d])=>document.getElementById(p).textContent=document.getElementById(i).value||d);
            
            // è®¡ç®—ç»“æœ
            document.getElementById('printRResult').textContent = document.getElementById('R_result').textContent || '0.00 D';
            document.getElementById('printLResult').textContent = document.getElementById('L_result').textContent || '0.00 D';
            
            // è¯¦ç»†å‚æ•°
            document.getElementById('printRParams').textContent = `å³çœ¼å‚æ•°ï¼š å¹´é¾„:${document.getElementById('commonAge').value || 0}, K1:${document.getElementById('R_K1').value || 0}, AL:${document.getElementById('R_AL').value || 0}`;
            document.getElementById('printLParams').textContent = `å·¦çœ¼å‚æ•°ï¼š å¹´é¾„:${document.getElementById('commonAge').value || 0}, K1:${document.getElementById('L_K1').value || 0}, AL:${document.getElementById('L_AL').value || 0}`;
            document.getElementById('printDiff').textContent = document.getElementById('refraction_diff').textContent || '0.00';
            document.getElementById('printRecommendation').textContent = document.getElementById('recommendation').textContent || 'æœªè®¡ç®—';
        }

        // æ‰“å°ç»“æœ
        function printResult() {
            fillPrintTemplate();
            window.print();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ å›è½¦é”®è®¡ç®—åŠŸèƒ½
            const inputs = document.querySelectorAll('input[type="number"], input[type="text"]');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculateRefraction();
                    }
                });
            });
        });
    </script>
</body>
</html>



