<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’å°‘å¹´è¿‘è§†é˜²æ§è¶‹åŠ¿é¢„æµ‹ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        button {
            background: #2196F3;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1976D2;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .prediction-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .prediction-table th {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .prediction-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .prediction-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .prediction-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .age-cell {
            font-weight: bold;
            background-color: #e9ecef !important;
        }
        
        .chart-container {
            height: 500px;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .high-diopter {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52) !important;
            color: white;
            font-weight: bold;
        }
        
        .medium-diopter {
            background: linear-gradient(45deg, #ffd166, #ffb700) !important;
            color: #333;
            font-weight: bold;
        }
        
        .low-diopter {
            background: linear-gradient(45deg, #06d6a0, #04b28a) !important;
            color: white;
            font-weight: bold;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
        }
        
        .summary-box {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é’å°‘å¹´è¿‘è§†é˜²æ§è¶‹åŠ¿é¢„æµ‹ç³»ç»Ÿ</h1>
            <p class="subtitle">ç§‘å­¦é¢„æµ‹ä¸åŒé˜²æ§æªæ–½ä¸‹çš„åº¦æ•°å‘å±•è¶‹åŠ¿</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <h2>ğŸ‘¤ è¯·è¾“å…¥é’å°‘å¹´ä¿¡æ¯</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="childName">å§“åï¼š</label>
                        <input type="text" id="childName" placeholder="è¯·è¾“å…¥å­©å­å§“å" value="å°æ˜">
                    </div>
                    <div class="form-group">
                        <label for="currentAge">å½“å‰å¹´é¾„ï¼š</label>
                        <input type="number" id="currentAge" min="6" max="17" value="12" placeholder="6-17å²">
                    </div>
                    <div class="form-group">
                        <label for="currentDiopter">å½“å‰åº¦æ•°ï¼ˆåº¦ï¼‰ï¼š</label>
                        <input type="number" id="currentDiopter" min="50" max="1000" value="350" placeholder="50-1000åº¦">
                    </div>
                </div>
                <button onclick="generatePrediction()">ç”Ÿæˆé¢„æµ‹ç»“æœ</button>
            </div>
            
            <div class="info-box">
                <p><strong>è¯´æ˜ï¼š</strong>æœ¬ç³»ç»Ÿå‡è®¾ä¸å¹²é¢„æƒ…å†µä¸‹æ¯å¹´å¢é•¿100åº¦è¿‘è§†åº¦æ•°ã€‚ä¸åŒé˜²æ§æªæ–½åŒ…æ‹¬ï¼šä¸å¹²é¢„ï¼ˆæ¯å¹´å¢é•¿100åº¦ï¼‰ã€25%é˜²æ§ã€50%é˜²æ§ã€75%é˜²æ§ã€‚æ•°å€¼æ˜¾ç¤ºä¸ºè´Ÿæ•°è¡¨ç¤ºè¿‘è§†åº¦æ•°ï¼ˆå¦‚-350Dè¡¨ç¤º350åº¦è¿‘è§†ï¼‰ã€‚</p>
            </div>
            
            <div class="summary-box" id="summaryBox" style="display: none;">
                <h3>ğŸ“Š é¢„æµ‹æ‘˜è¦</h3>
                <p id="summaryText"></p>
            </div>
            
            <div class="result-section">
                <h2 id="resultTitle">é¢„æµ‹ç»“æœ</h2>
                <div class="table-container">
                    <table class="prediction-table" id="predictionTable">
                        <thead>
                            <tr>
                                <th>å¹´é¾„</th>
                                <th>ä¸å¹²é¢„</th>
                                <th>25%é˜²æ§</th>
                                <th>50%é˜²æ§</th>
                                <th>75%é˜²æ§</th>
                            </tr>
                        </thead>
                        <tbody id="predictionBody">
                            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <h2>ğŸ“ˆ ä¸åŒé˜²æ§æªæ–½ä¸‹çš„åº¦æ•°å‘å±•è¶‹åŠ¿</h2>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
        
        <footer>
            <p>âš ï¸ é‡è¦å£°æ˜ï¼šæœ¬ç³»ç»Ÿä»…ä¾›ç§‘æ™®å‚è€ƒï¼Œå…·ä½“æ²»ç–—æ–¹æ¡ˆè¯·å’¨è¯¢ä¸“ä¸šçœ¼ç§‘åŒ»ç”Ÿ</p>
            <p>æ•°æ®æ¨¡å‹åŸºäºé’å°‘å¹´è¿‘è§†å‘å±•çš„ä¸€èˆ¬è§„å¾‹æ„å»ºï¼Œå‡è®¾ä¸å¹²é¢„æƒ…å†µä¸‹æ¯å¹´å¢é•¿100åº¦</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        let trendChart = null;

        // ç”Ÿæˆé¢„æµ‹æ•°æ®
        function generatePrediction() {
            const name = document.getElementById('childName').value || 'å°æœ‹å‹';
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const currentDiopter = parseInt(document.getElementById('currentDiopter').value);

            if (!currentAge || !currentDiopter || currentAge < 6 || currentAge > 17 || currentDiopter < 50 || currentDiopter > 1000) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„ï¼ˆ6-17å²ï¼‰å’Œåº¦æ•°ï¼ˆ50-1000åº¦ï¼‰');
                return;
            }

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('resultTitle').textContent = `${name}ï¼ˆ${currentAge}å²ï¼Œ${currentDiopter}åº¦ï¼‰çš„åº¦æ•°å‘å±•è¶‹åŠ¿é¢„æµ‹`;

            // è®¡ç®—é¢„æµ‹æ•°æ®
            const tableBody = document.getElementById('predictionBody');
            tableBody.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            // å­˜å‚¨å›¾è¡¨æ•°æ®
            const chartData = {
                labels: [],
                datasets: [
                    {
                        label: 'ä¸å¹²é¢„ï¼ˆæ¯å¹´å¢é•¿100åº¦ï¼‰',
                        data: [],
                        borderColor: '#FF6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '25%é˜²æ§',
                        data: [],
                        borderColor: '#36A2EB',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '50%é˜²æ§',
                        data: [],
                        borderColor: '#4BC0C0',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: '75%é˜²æ§',
                        data: [],
                        borderColor: '#FFCD56',
                        backgroundColor: 'rgba(255, 205, 86, 0.1)',
                        tension: 0.4
                    }
                ]
            };

            // å­˜å‚¨å…³é”®æ•°æ®ç”¨äºæ‘˜è¦
            let finalNoControl = 0;
            let finalControl50 = 0;
            let yearsTo18 = 18 - currentAge;

            for (let age = currentAge; age <= 18; age++) {
                const yearsFromNow = age - currentAge;
                
                // è®¡ç®—ä¸åŒé˜²æ§æªæ–½ä¸‹çš„åº¦æ•°ï¼ˆä¸å¹²é¢„æ¯å¹´å¢é•¿100åº¦ï¼‰
                const noControl = calculateDiopter(currentDiopter, yearsFromNow, 0);
                const control25 = calculateDiopter(currentDiopter, yearsFromNow, 0.25);
                const control50 = calculateDiopter(currentDiopter, yearsFromNow, 0.5);
                const control75 = calculateDiopter(currentDiopter, yearsFromNow, 0.75);

                // è®°å½•18å²æ—¶çš„æ•°æ®
                if (age === 18) {
                    finalNoControl = noControl;
                    finalControl50 = control50;
                }

                // æ·»åŠ åˆ°å›¾è¡¨æ•°æ®
                chartData.labels.push(`${age}å²`);
                chartData.datasets[0].data.push(noControl);
                chartData.datasets[1].data.push(control25);
                chartData.datasets[2].data.push(control50);
                chartData.datasets[3].data.push(control75);

                // åˆ›å»ºè¡¨æ ¼è¡Œ
                const row = document.createElement('tr');
                
                // æ ¹æ®åº¦æ•°èŒƒå›´åˆ†é…é¢œè‰²ç±»
                function getDiopterClass(diopter) {
                    const absDiopter = Math.abs(diopter);
                    if (absDiopter >= 600) return 'high-diopter';
                    if (absDiopter >= 300) return 'medium-diopter';
                    return 'low-diopter';
                }

                row.innerHTML = `
                    <td class="age-cell">${age}å²</td>
                    <td class="${getDiopterClass(noControl)}">${noControl}D</td>
                    <td class="${getDiopterClass(control25)}">${control25}D</td>
                    <td class="${getDiopterClass(control50)}">${control50}D</td>
                    <td class="${getDiopterClass(control75)}">${control75}D</td>
                `;
                
                tableBody.appendChild(row);
            }

            // æ˜¾ç¤ºæ‘˜è¦
            const preventedDiopter = Math.abs(currentDiopter) - Math.abs(finalControl50);
            document.getElementById('summaryText').innerHTML = `
                å¦‚æœä»ç°åœ¨å¼€å§‹é‡‡å–50%é˜²æ§æªæ–½ï¼Œåˆ°18å²æ—¶ç›¸æ¯”ä¸å¹²é¢„å¯é¢„é˜²åŠ æ·±çº¦<strong>${Math.abs(preventedDiopter)}</strong>åº¦ã€‚
                ä¸å¹²é¢„æƒ…å†µä¸‹18å²æ—¶é¢„è®¡è¾¾åˆ°<strong>${Math.abs(finalNoControl)}</strong>åº¦ï¼Œ
                50%é˜²æ§æªæ–½ä¸‹é¢„è®¡è¾¾åˆ°<strong>${Math.abs(finalControl50)}</strong>åº¦ã€‚
            `;
            document.getElementById('summaryBox').style.display = 'block';

            // é”€æ¯æ—§å›¾è¡¨å®ä¾‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (trendChart) {
                trendChart.destroy();
            }

            // è·å–ç”»å¸ƒä¸Šä¸‹æ–‡
            const ctx = document.getElementById('trendChart').getContext('2d');

            // åˆ›å»ºæ–°å›¾è¡¨
            trendChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `ä»${currentAge}å²åˆ°18å²ä¸åŒé˜²æ§æªæ–½ä¸‹çš„åº¦æ•°å‘å±•è¶‹åŠ¿ï¼ˆä¸å¹²é¢„æ¯å¹´å¢é•¿100åº¦ï¼‰`,
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            reverse: false, // å°åº¦æ•°åœ¨ä¸‹æ–¹ï¼Œå¤§åº¦æ•°åœ¨ä¸Šæ–¹
                            title: {
                                display: true,
                                text: 'åº¦æ•° (D)',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return Math.abs(value) + 'D';
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å¹´é¾„',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // è®¡ç®—åº¦æ•°çš„è¾…åŠ©å‡½æ•°
        function calculateDiopter(initialDiopter, years, controlRate) {
            // åŸºç¡€å¢é•¿ï¼šæ¯å¹´100åº¦
            const baseAnnualGrowth = 100;
            
            // è®¡ç®—æ€»å¢é•¿é‡ï¼ˆåº”ç”¨é˜²æ§æªæ–½ï¼‰
            const totalGrowth = baseAnnualGrowth * years * (1 - controlRate);
            
            // è¿”å›è®¡ç®—åçš„åº¦æ•°ï¼ˆä¿æŒè´Ÿå€¼è¡¨ç¤ºè¿‘è§†ï¼‰
            return Math.round(initialDiopter + totalGrowth);
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹æ•°æ®
        window.onload = function() {
            generatePrediction();
        };
    </script>
</body>
</html>



